<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <title>Next F1 Race</title>

      <link id="mainStylesheet" rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>

  <body>

      <nav class="top-vertical-nav" aria-label="Main navigation">
          <a href="{{ url_for('index') }}"><span class="icon">üèÅ</span>Home</a>
          <a href="{{ url_for('schedule_page') }}"><span class="icon">üìÖ</span>Race Schedule</a>
          <a href="{{ url_for('next_race') }}" class="active"><span class="icon">üó∫Ô∏è</span>Track of the Week</a>
      </nav>

      <div id="timezoneSelector" class="tz-wrapper">
          <select id="timezoneSelect">
              <option value="America/New_York" selected>EST</option>
              <option value="America/Chicago">CST</option>
              <option value="America/Denver">MST</option>
              <option value="America/Los_Angeles">PST</option>

              <option value="Europe/London">GMT</option>
              <option value="Europe/Paris">CET</option>
              <option value="Europe/Berlin">CET</option>

              <option value="Asia/Kolkata">IST</option>
              <option value="Asia/Dubai">GST</option>
              <option value="Asia/Singapore">SGT</option>
              <option value="Asia/Tokyo">JST</option>

              <option value="Australia/Sydney">AEDT</option>
          </select>
      </div>

      <main class="main" role="main">
          <section class="card" style="max-width:720px;margin:24px auto;">
              <h1>Next Race ({{ year }})</h1>
              <h2 style="margin-top:8px;">{{ event["EventName"] }}</h2> 

              <p class="kv"><strong>Country:</strong>&nbsp;<span style="color:var(--muted)">{{ get_flag(event["Country"]) }} {{ event["Country"] }}</span></p>
              <p class="kv"><strong>Location:</strong>&nbsp;<span style="color:var(--muted)">{{ event.get("Location", "‚Äî") }}</span></p>

              <p class="kv">
                  <strong>Date:</strong>&nbsp;
                  <span class="race-date" data-utc="{{ event.get('date_utc', event['EventDate']) }}" style="color:var(--muted)"></span>
              </p>

              <div style="margin-top:16px;">
                  <a href="{{ url_for('index') }}" class="pill">Back to Calendar</a>
                  <a href="{{ url_for('track_layout', year=year, gp_name=event['FastF1Name']) }}" class="pill" style="margin-left:8px;">Open Track</a>
              </div>
          </section>
      </main>

      <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>

      <script>
          function convertAllTimes() {
              const tz = document.getElementById("timezoneSelect").value;
              const cells = document.querySelectorAll(".race-date");

              cells.forEach(cell => {
                  const utcTime = cell.getAttribute("data-utc");
                  const date = new Date(utcTime);

                  const options = {
                      year: "numeric",
                      month: "short",
                      day: "numeric",
                      hour: "2-digit",
                      minute: "2-digit",
                      timeZone: tz
                  };

                  const formatted = date.toLocaleString("en-US", options);
                  cell.textContent = formatted;
              });
          }

          document.getElementById("timezoneSelect").addEventListener("change", convertAllTimes);

          // Run on page load
          convertAllTimes();
      </script>

  </body>
</html>
