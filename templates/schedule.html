<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>F1 Calendar</title>

        <link id="mainStylesheet" rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    </head>

    <body>

        <nav class="top-vertical-nav" aria-label="Main navigation">
            <a href="{{ url_for('index') }}"><span class="icon">üèÅ</span>Home</a>
            <a href="{{ url_for('schedule') }}" class="active"><span class="icon">üìÖ</span>Race Schedule</a>
            <a href="{{ url_for('next_race') }}"><span class="icon">üó∫Ô∏è</span>Track of the Week</a>
        </nav>

        <div id="timezoneSelector" class="tz-wrapper">
            <select id="timezoneSelect">
                <option value="America/New_York" selected>EST</option>
                <option value="America/Chicago">CST</option>
                <option value="America/Denver">MST</option>
                <option value="America/Los_Angeles">PST</option>

                <option value="Europe/London">GMT</option>
                <option value="Europe/Paris">CET</option>
                <option value="Europe/Berlin">CET</option>

                <option value="Asia/Kolkata">IST</option>
                <option value="Asia/Dubai">GST</option>
                <option value="Asia/Singapore">SGT</option>
                <option value="Asia/Tokyo">JST</option>

                <option value="Australia/Sydney">AEDT</option>
            </select>
        </div>

        <main class="main" role="main">
            <header class="card" style="margin-bottom:18px;">
                <h1>F1 Calendar {{ year }}</h1>
                <p class="lead">Season schedule ‚Äî click a race to view details or open the Track of the Week.</p>
            </header>

            <section class="content-grid">
                <div class="card">
                    <h2>Upcoming Races</h2>
                    <div class="kv" style="margin-bottom:10px;">
                        <span class="pill">Total: {{ schedule|length }}</span>
                        <span class="kv" style="margin-left:auto;color:var(--muted);font-size:0.9rem;">Year: {{ year }}</span>
                    </div>

                    <div style="overflow:auto;">
                        <table class="race-table" style="width:100%;border-collapse:collapse;">
                            <thead>
                                <tr style="text-align:left;color:var(--muted);font-size:0.9rem;">
                                    <th style="padding:8px 10px">Event</th>
                                    <th style="padding:8px 10px">Country</th>
                                    <th style="padding:8px 10px">Date</th>
                                    <th style="padding:8px 10px"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in schedule %}
                                <tr style="border-top:1px solid rgba(255,255,255,0.02);">
                                    <td style="padding:10px 8px;font-weight:600">{{ row.EventName }}</td>
                                    <td style="padding:10px 8px;color:var(--muted)">{{ row.Country }}</td>

                                    <!-- Store UTC version -->
                                    <td class="race-date" data-utc="{{ row.date_utc }}" style="padding:10px 8px;color:var(--muted)"></td>

                                    <td style="padding:10px 8px;text-align:right;">
                                        <a href="#" class="pill" style="text-decoration:none;color:inherit;">View</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>

        <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
        <script>
        function convertAllTimes() {
            const tz = document.getElementById("timezoneSelect").value;
            const cells = document.querySelectorAll(".race-date");

            cells.forEach(cell => {
                const utcTime = cell.getAttribute("data-utc");
                const date = new Date(utcTime);

                const options = {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                    hour: "2-digit",
                    minute: "2-digit",
                    timeZone: tz
                };

                const formatted = date.toLocaleString("en-US", options);
                cell.textContent = formatted;
            });
        }

        document.getElementById("timezoneSelect").addEventListener("change", convertAllTimes);

        // Run on page load
        convertAllTimes();
        </script>


    </body>
</html>
